在数据库理论中很重要的一块知识就是完整性。本文讲解关系数据库的三类完整性。



一：实体完整性

根据实体完整性规则，RDBMS将进行自动检查，包括两点：

1：检查主码值是否唯一，如果不唯一则拒绝插入或修改。

2：检查主码的各个属性是否为空，只要有一个为空就拒绝插入或修改。

从而保证实体完整性。简单说就是检查主码是否unique，是否null。

检查主码值是否唯一有一种方法是全表扫描。顾名思义，一次判断每条记录与当前主码值是否相同。

全表扫描很耗时。为了避免全表扫描，RDBMS核心一般都在主码建立一个B+树索引(不熟悉的同学可以先百度，我随后会发布数据结构的文章)。通过索引可以大大提高查找的速度。

二:参照完整性

关系模型的参照完整性用FOREIGN KEY定义哪些为外码，用REFERENCES指明这些外码参照哪些表的主码。简单说就是参照完整性将两个表中相应的元组联系起来了。

做web项目经常会遇到参照完整性的问题。打个比方，不很妥当，只是为说明问题。做电子商务系统，有购物车和用户两个表。可能会将购物车的外键参照用户表的主键。如果这时删除用户表里某条记录。而此人在购物车表里也有记录。那此时就会涉及到上述的参照完整性。

当发生可能破坏参照完整性的情况出现时，可选用如下几种方式处理。

1：no action 不允许操作执行。一般为默认策略。

2：restrict  不允许操作。

关于no action与restrict在网上找到一段官方资料

When updating key values in the parent table, there are two rules that can be

specified: RESTRICT and NO ACTION. RESTRICT does not allow a key value to
be updated if there are dependent rows in a dependent table. NO ACTION
causes the update operation on a parent key value to be rejected if, at the
end of the update, there are dependent rows in a dependent table that do not
have a parent key in the parent table.

在更新父表中的键值时，可以指定两条规则：RESTRICT 和 NO ACTION。如果从属表中有从属行，则 RESTRICT 不允许更新键值。如果在更新完成时在从属表中有从属行，而从属行在父表中没有父键，则 NO ACTION 将导致对父键值的更新操作被拒绝。

RESTRICT 是在更新之前限制，
NO ACTION 是在更新之后限制，
结果一样，判断的时间点不同。

3：cascade  当删除或修改被参照表(用户表)的一个元组造成了与参照表(购物车表)的不一致，则删除或修改参照表中的所有不一致的元组。

4：set null当删除或修改被参照表(用户表)的一个元组造成了与参照表(购物车表)的不一致，则将参照表中造成不一致的元组设为空值。

三：用户自定义完整性

用户自定义完整性指的是针对某一具体应用的数据必须满足的语义要求。说白了就是比如你不允许你的部门名为空啦，姓名必须唯一啦，性别只能取男女啦等等等。

以上就是完整性的全部内容，望各位不吝指正。
